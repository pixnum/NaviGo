<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NaviGo - Smart GPS Navigation</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><circle cx='32' cy='32' r='30' fill='black'/><circle cx='32' cy='32' r='12' fill='white'/></svg>">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',sans-serif;}
html,body{height:100%;width:100%;background:#f0f0f0;color:#222;display:flex;justify-content:center;align-items:flex-start;overflow:hidden;}
body.dark{background:#121212;color:#f0f0f0;}
.container{width:100%;max-width:500px;margin:0 auto;display:flex;flex-direction:column;align-items:center;border:2px solid #ccc;border-radius:16px;position:relative;background:#fff;overflow:hidden;box-shadow:0 6px 20px rgba(0,0,0,.15);}
body.dark .container{background:#1e1e1e;border-color:#555;}
.header {position:absolute;top:10px;left:50%;transform:translateX(-50%);display:flex;align-items:center;gap:0.5rem;z-index:1000;}
.app-icon {font-size:1.5rem;}
.app-title {font-size:1.5rem;margin:0;}
#toggleDark {position:absolute;top:10px;right:10px;width:45px;height:45px;border-radius:50%;border:2px solid #ccc;display:flex;justify-content:center;align-items:center;font-weight:bold;font-size:1.3rem;background:#fff;color:#222;cursor:pointer;z-index:1001;transition:.3s;}
body.dark #toggleDark {background:#333;color:#fff;border-color:#666;}
#map{margin-top:60px;width:100%;height:350px;}
.control-panel{width:100%;padding:0.5rem 1rem;display:flex;flex-direction:column;gap:0.5rem;}
.row{display:flex;flex-direction:row;justify-content:space-between;gap:0.5rem;flex-wrap:wrap;}
.row input, .row button, .row select{flex:1 1 48%;min-width:0;padding:0.5rem 0.7rem;border-radius:10px;border:1px solid #ccc;font-size:0.95rem;}
.row button{background:#007bff;color:#fff;border:none;cursor:pointer;transition:.3s;}
.row button:hover{opacity:.85;}
#status,p{font-size:0.85rem;word-wrap:break-word;}
.compass{font-weight:bold;}
#calibrationHint{color:#d9534f;font-weight:bold;display:none;}
#publicTransport,#trafficAlerts,#poiList{font-size:0.85rem;margin-top:0.3rem;}
footer{width:100%;text-align:center;padding:0.5rem 0;font-size:0.8rem;color:#888;border-top:1px solid #ccc;position:sticky;bottom:0;background:#fff;z-index:999;}
body.dark footer{color:#aaa;border-color:#555;background:#1e1e1e;}
#zoomControls{position:absolute;top:60px;right:10px;display:flex;flex-direction:column;gap:5px;z-index:1002;}
#zoomControls button{width:35px;height:35px;border-radius:8px;border:none;background:#007bff;color:#fff;font-weight:bold;cursor:pointer;}
@media(max-width:500px){#map{height:300px;} .app-title{font-size:1.3rem;} .app-icon{font-size:1.3rem;}}
</style>
</head>
<body>
<div class="container">
<div class="header">
  <span class="app-icon">üß≠</span>
  <h1 class="app-title">NaviGo</h1>
</div>
<div id="toggleDark">üåì</div>

<div id="zoomControls">
  <button id="zoomIn">+</button>
  <button id="zoomOut">-</button>
</div>

<div class="control-panel">
<p id="status">Click "Start Tracking" to begin</p>
<p id="latitude"></p>
<p id="longitude"></p>
<p id="altitude"></p>
<p id="speed"></p>
<p id="accuracy"></p>
<p class="compass" id="compass">Compass: --¬∞ (--)</p>
<p id="calibrationHint">‚ö†Ô∏è Move your device in a figure-8 to calibrate the compass</p>
<p id="street">Street: --</p>

<div class="row">
<button id="getLocation">Start Tracking</button>
<button id="sos">Emergency SOS</button>
</div>

<div class="row">
<input type="text" id="destination" placeholder="Enter destination"/>
<button id="navigateBtn">Navigate</button>
</div>

<div class="row">
<button id="addBookmark">Add Bookmark</button>
<button id="clearMarkers">Clear Map</button>
</div>

<div class="row">
<select id="mode">
<option value="driving-car">Driving</option>
<option value="cycling-regular">Cycling</option>
<option value="foot-walking">Walking</option>
</select>
</div>

<div class="row">
<button id="batterySaverBtn">Battery Saver: OFF</button>
</div>

<div class="row">
<button id="rideShareBtn">Ride-Sharing</button>
<button id="wearableSyncBtn">Sync to Wearable</button>
</div>

<div class="row">
<button id="loadPOIs">Load Nearby POIs</button>
<button id="loadTraffic">Load Traffic Alerts</button>
</div>

<div id="publicTransport"></div>
<div id="trafficAlerts"></div>
<div id="poiList"></div>
<div class="bookmarks" id="bookmarkList"></div>
</div>

<div id="map"></div>
<footer>¬© Manik Roy 2025 | All Rights Reserved</footer>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// Map setup
let map = L.map('map').setView([0,0],2);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19, attribution:'&copy; OpenStreetMap contributors'}).addTo(map);
let marker, routeLine=L.polyline([], {color:'blue'}).addTo(map);
let watchId=null, previousPos=null, totalDistance=0, destinationPos=null;
let bookmarks=JSON.parse(localStorage.getItem('bookmarks')||"[]");

// Elements
const latElem=document.getElementById('latitude'), lonElem=document.getElementById('longitude'),
altElem=document.getElementById('altitude'), speedElem=document.getElementById('speed'),
accuracyElem=document.getElementById('accuracy'), compassElem=document.getElementById('compass'),
streetElem=document.getElementById('street'), status=document.getElementById('status'),
getLocationBtn=document.getElementById('getLocation'), toggleDarkBtn=document.getElementById('toggleDark'),
destinationInput=document.getElementById('destination'), navigateBtn=document.getElementById('navigateBtn'),
addBookmarkBtn=document.getElementById('addBookmark'), clearMarkersBtn=document.getElementById('clearMarkers'),
sosBtn=document.getElementById('sos'), bookmarkList=document.getElementById('bookmarkList'),
calibrationHint=document.getElementById('calibrationHint'), batteryBtn=document.getElementById('batterySaverBtn'),
rideShareBtn=document.getElementById('rideShareBtn'), wearableBtn=document.getElementById('wearableSyncBtn'),
publicTransportDiv=document.getElementById('publicTransport'),
trafficAlertsDiv=document.getElementById('trafficAlerts'),
poiListDiv=document.getElementById('poiList'),
loadPOIsBtn=document.getElementById('loadPOIs'), loadTrafficBtn=document.getElementById('loadTraffic');

let batterySaver=false;
let gpsOptions={enableHighAccuracy:true,maximumAge:0,timeout:10000};
let lastSpeakTime=0,lastDistance=null;

// Dark mode
toggleDarkBtn.addEventListener('click',()=>{document.body.classList.toggle('dark');map.getContainer().style.filter=document.body.classList.contains('dark')?'invert(90%) hue-rotate(180deg)':'';});

// Zoom controls
document.getElementById('zoomIn').addEventListener('click',()=>{map.zoomIn();});
document.getElementById('zoomOut').addEventListener('click',()=>{map.zoomOut();});

// Compass
function getDirectionName(deg){const dirs=['N','NE','E','SE','S','SW','W','NW'];return dirs[Math.round(deg/45)%8];}
let compassHeading=0,lastHeading=null,unstableCount=0;
function handleOrientation(event){
  let alpha=event.alpha;
  if(event.absolute && alpha!==null){
    compassHeading=360-alpha;
    compassElem.textContent=`Compass: ${compassHeading.toFixed(0)}¬∞ (${getDirectionName(compassHeading)})`;
    if(lastHeading!==null && Math.abs(compassHeading-lastHeading)>20){unstableCount++;}else{unstableCount=0;}
    lastHeading=compassHeading;
    calibrationHint.style.display=(unstableCount>=3)?'block':'none';
  }
}
function enableCompass(){
  if(typeof DeviceOrientationEvent.requestPermission==='function'){
    DeviceOrientationEvent.requestPermission().then(r=>{if(r==='granted')window.addEventListener('deviceorientationabsolute',handleOrientation,true);}).catch(console.error);
  } else{window.addEventListener('deviceorientationabsolute',handleOrientation,true);}
}

// Distance
function calcDistance(lat1,lon1,lat2,lon2){const R=6371e3,œÜ1=lat1*Math.PI/180,œÜ2=lat2*Math.PI/180,ŒîœÜ=(lat2-lat1)*Math.PI/180,ŒîŒª=(lon2-lon1)*Math.PI/180;const a=Math.sin(ŒîœÜ/2)**2+Math.cos(œÜ1)*Math.cos(œÜ2)*Math.sin(ŒîŒª/2)**2;const c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return R*c;}
async function updateStreetName(lat,lon){try{let res=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`);let data=await res.json();streetElem.textContent=`Street: ${data.address.road||'--'}`;}catch(e){streetElem.textContent='Street: --';}}

// Voice guidance
function speakDistance(lat1,lon1,lat2,lon2){
  if(!window.speechSynthesis)return;
  const distanceKm=calcDistance(lat1,lon1,lat2,lon2)/1000;
  if(lastDistance!==null&&Math.abs(distanceKm-lastDistance)<0.05)return;
  lastDistance=distanceKm;
  const now=Date.now();
  if(now-lastSpeakTime<3000)return;
  lastSpeakTime=now;
  window.speechSynthesis.cancel();
  const msg=new SpeechSynthesisUtterance(`You are ${distanceKm.toFixed(1)} kilometers from your destination`);
  msg.lang='en-US';window.speechSynthesis.speak(msg);
}

// Battery Saver
batteryBtn.addEventListener('click',()=>{
  batterySaver=!batterySaver;
  if(batterySaver){gpsOptions.enableHighAccuracy=false;gpsOptions.maximumAge=30000;batteryBtn.textContent='Battery Saver: ON';}
  else{gpsOptions.enableHighAccuracy=true;gpsOptions.maximumAge=0;batteryBtn.textContent='Battery Saver: OFF';}
  if(watchId) navigator.geolocation.clearWatch(watchId);
  startTracking();
});

// Tracking
function startTracking(){
  if(!navigator.geolocation){alert("Geolocation not supported");status.textContent="Geolocation not supported";return;}
  if(watchId) navigator.geolocation.clearWatch(watchId);
  watchId=navigator.geolocation.watchPosition(
    function success(pos){
      if(!pos||!pos.coords)return;
      const lat=pos.coords.latitude,lon=pos.coords.longitude;
      const alt=pos.coords.altitude||0,speed=pos.coords.speed||0,accuracy=pos.coords.accuracy||0;
      status.textContent="Tracking location‚Ä¶";
      latElem.textContent=`Latitude: ${lat.toFixed(6)}`;
      lonElem.textContent=`Longitude: ${lon.toFixed(6)}`;
      altElem.textContent=`Altitude: ${alt.toFixed(2)} m`;
      speedElem.textContent=`Speed: ${(speed*3.6).toFixed(2)} km/h`;
      accuracyElem.textContent=`GPS Accuracy: ${accuracy} m`;
      if(marker) marker.setLatLng([lat,lon]);
      else marker=L.marker([lat,lon]).addTo(map).bindPopup("You are here").openPopup();
      map.setView([lat,lon],15);
      if(previousPos) totalDistance+=calcDistance(previousPos.lat,previousPos.lon,lat,lon);
      previousPos={lat,lon};
      updateStreetName(lat,lon);
      updateRoute(lat,lon);
    },
    function error(err){switch(err.code){case err.PERMISSION_DENIED: alert("Location permission denied");status.textContent="Permission denied"; break; case err.POSITION_UNAVAILABLE: alert("Location unavailable");status.textContent="Location unavailable"; break; case err.TIMEOUT: alert("Location request timed out");status.textContent="Timeout"; break;}},
    gpsOptions
  );
}
getLocationBtn.addEventListener('click',()=>{startTracking(); enableCompass();});

// Destination
function updateRoute(lat,lon){if(destinationPos){routeLine.setLatLngs([[lat,lon],[destinationPos.lat,destinationPos.lon]]); speakDistance(lat,lon,destinationPos.lat,destinationPos.lon);}}
navigateBtn.addEventListener('click',async ()=>{
  const val=destinationInput.value.trim();
  if(!val)return alert("Enter destination");
  try{
    let res=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(val)}`);
    let data=await res.json();
    if(data.length>0){destinationPos={lat:parseFloat(data[0].lat),lon:parseFloat(data[0].lon)};alert("Destination set!");}
    else{alert("Destination not found");}
  }catch(e){alert("Error fetching destination");}
});

// Bookmarks
function renderBookmarks(){bookmarkList.innerHTML='';bookmarks.forEach(b=>{const btn=document.createElement('button');btn.textContent=b.name;btn.style.width='100%';btn.addEventListener('click',()=>{map.setView([b.lat,b.lon],15);});bookmarkList.appendChild(btn);});}
addBookmarkBtn.addEventListener('click',()=>{if(!previousPos)return alert("Start tracking first");const name=prompt("Enter bookmark name","Bookmark");if(name){bookmarks.push({name,lat:previousPos.lat,lon:previousPos.lon});localStorage.setItem('bookmarks',JSON.stringify(bookmarks));renderBookmarks();}});
clearMarkersBtn.addEventListener('click',()=>{if(marker) marker.remove();marker=null;routeLine.setLatLngs([]);destinationPos=null;});
sosBtn.addEventListener('click',()=>{if(!previousPos)return alert("Start tracking first");alert(`Emergency! Location: ${previousPos.lat.toFixed(6)}, ${previousPos.lon.toFixed(6)}`);});

// Ride-sharing
rideShareBtn.addEventListener('click',()=>{if(!previousPos)return alert("Start tracking first");window.open(`https://m.uber.com/ul/?action=setPickup&pickup[latitude]=${previousPos.lat}&pickup[longitude]=${previousPos.lon}`,'_blank');});
wearableBtn.addEventListener('click',()=>{alert("Wearable sync placeholder");});

// Optional features loaded on demand
loadPOIsBtn.addEventListener('click',async ()=>{
  if(!previousPos) return alert("Start tracking first");
  poiListDiv.textContent="Loading nearby POIs...";
  try{
    let res=await fetch(`https://overpass-api.de/api/interpreter?data=[out:json];node(around:1000,${previousPos.lat},${previousPos.lon})[amenity~'fuel|restaurant|hospital'];out;`);
    let data=await res.json();poiListDiv.textContent="";
    data.elements.forEach(e=>{const p=document.createElement('div');p.textContent=`${e.tags.name||e.tags.amenity} (${e.lat.toFixed(5)},${e.lon.toFixed(5)})`;poiListDiv.appendChild(p);});
  }catch(e){poiListDiv.textContent="No POIs found";}
});

loadTrafficBtn.addEventListener('click',()=>{trafficAlertsDiv.textContent="Traffic alerts placeholder";});

// Initialize bookmarks
renderBookmarks();
</script>
</body>
</html>

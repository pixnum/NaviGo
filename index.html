<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NaviGo - Smart GPS Navigation</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><circle cx='32' cy='32' r='30' fill='black'/><circle cx='32' cy='32' r='12' fill='white'/></svg>">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',sans-serif;}
html,body{height:100%;width:100%;background:#f0f0f0;color:#222;overflow:auto;}
body.dark{background:#121212;color:#f0f0f0;}
.container{width:100%;max-width:500px;margin:0 auto;display:flex;flex-direction:column;border:2px solid #ccc;border-radius:16px;position:relative;background:#fff;overflow:visible;box-shadow:0 6px 20px rgba(0,0,0,.15);}
body.dark .container{background:#1e1e1e;border-color:#555;}
.header {position:sticky;top:0;width:100%;display:flex;justify-content:center;align-items:center;background:#fff;z-index:1000;padding:0.5rem 0;}
body.dark .header{background:#1e1e1e;}
.header-center {display:flex;flex-direction:row;align-items:center;justify-content:center;gap:0.5rem;}
.app-icon {font-size:1.5rem;}
.app-title {font-size:1.5rem;margin:0;}
#toggleDark {position:absolute;top:10px;right:10px;width:45px;height:45px;border-radius:50%;border:2px solid #ccc;display:flex;justify-content:center;align-items:center;font-weight:bold;font-size:1.3rem;background:#fff;color:#222;cursor:pointer;z-index:1001;transition:.3s;}
body.dark #toggleDark {background:#333;color:#fff;border-color:#666;}
#map{margin-top:0;width:100%;height:400px;position:relative;}
.control-panel{width:100%;padding:0.5rem 1rem;display:flex;flex-direction:column;gap:0.5rem;overflow:auto;}
.row{display:flex;flex-direction:row;justify-content:space-between;gap:0.5rem;flex-wrap:wrap;}
.row input, .row button, .row select{flex:1 1 48%;min-width:0;padding:0.5rem 0.7rem;border-radius:10px;border:1px solid #ccc;font-size:0.95rem;}
.row button{background:#007bff;color:#fff;border:none;cursor:pointer;transition:.3s;}
.row button:hover{opacity:.85;}
#status,p{font-size:0.85rem;word-wrap:break-word;}
.compass{font-weight:bold;}
#calibrationHint{color:#d9534f;font-weight:bold;display:none;}
footer{width:100%;text-align:center;padding:0.5rem 0;font-size:0.8rem;color:#888;border-top:1px solid #ccc;position:sticky;bottom:0;background:#fff;z-index:999;}
body.dark footer{color:#aaa;border-color:#555;background:#1e1e1e;}
#zoomControls{position:absolute;top:60px;right:10px;display:flex;flex-direction:column;gap:5px;z-index:1002;}
#zoomControls button{width:35px;height:35px;border-radius:8px;border:none;background:#007bff;color:#fff;font-weight:bold;cursor:pointer;}
#mapLayerSelector{margin:0.5rem 0;}
@media(max-width:500px){#map{height:300px;} .app-title{font-size:1.3rem;} .app-icon{font-size:1.3rem;}}
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <div class="header-center">
      <span class="app-icon">üß≠</span>
      <h1 class="app-title">NaviGo</h1>
    </div>
    <div id="toggleDark">üåì</div>
  </div>

  <div id="zoomControls">
    <button id="zoomIn">+</button>
    <button id="zoomOut">-</button>
  </div>

  <div id="map"></div>

  <div class="control-panel">
    <p id="status">Click "Start Tracking" to begin</p>
    <p id="latitude"></p>
    <p id="longitude"></p>
    <p id="altitude"></p>
    <p id="speed"></p>
    <p id="accuracy"></p>
    <p class="compass" id="compass">Compass: --¬∞ (--)</p>
    <p id="calibrationHint">‚ö†Ô∏è Move your device in a figure-8 to calibrate the compass</p>
    <p id="street">Street: --</p>

    <div id="mapLayerSelector">
      <select id="mapLayerSelect">
        <option value="Street">Street</option>
        <option value="Topographic">Topographic</option>
        <option value="Satellite">Satellite</option>
        <option value="Dark">Dark</option>
      </select>
    </div>

    <div class="row">
      <button id="getLocation">Start Tracking</button>
      <button id="sos">Emergency SOS</button>
    </div>

    <div class="row">
      <input type="text" id="destination" placeholder="Enter destination"/>
      <button id="navigateBtn">Navigate</button>
    </div>

    <div class="row">
      <button id="addBookmark">Add Bookmark</button>
      <button id="clearMarkers">Clear Map</button>
    </div>

    <div class="row">
      <select id="mode">
        <option value="driving-car">Driving</option>
        <option value="cycling-regular">Cycling</option>
        <option value="foot-walking">Walking</option>
      </select>
    </div>

    <div class="row">
      <button id="batterySaverBtn">Battery Saver: OFF</button>
    </div>

    <div class="bookmarks" id="bookmarkList"></div>
  </div>
  <footer>¬© Manik Roy 2025 | All Rights Reserved</footer>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// ===================== Map & Layers =====================
const streetLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19, attribution:'&copy; OpenStreetMap contributors'});
const topoLayer = L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',{maxZoom:17, attribution:'&copy; OpenTopoMap contributors'});
const satelliteLayer = L.tileLayer('https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{maxZoom:20, subdomains:['mt0','mt1','mt2','mt3'], attribution:'¬© Google'});
const darkLayer = L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_dark/{z}/{x}/{y}{r}.png',{maxZoom:20, attribution:'&copy; Stadia Maps &copy; OpenMapTiles &copy; OpenStreetMap contributors'});

let map = L.map('map',{center:[0,0],zoom:2,layers:[streetLayer]});
const baseMaps = {"Street":streetLayer,"Topographic":topoLayer,"Satellite":satelliteLayer,"Dark":darkLayer};
document.getElementById('mapLayerSelect').addEventListener('change',function(){
  const val=this.value;
  map.eachLayer(layer=>{
    if(Object.values(baseMaps).includes(layer)) map.removeLayer(layer);
  });
  baseMaps[val].addTo(map);
});

// ===================== Dark Mode =====================
document.getElementById('toggleDark').addEventListener('click',()=>document.body.classList.toggle('dark'));

// ===================== Zoom Controls =====================
document.getElementById('zoomIn').addEventListener('click',()=>map.zoomIn());
document.getElementById('zoomOut').addEventListener('click',()=>map.zoomOut());

// ===================== GPS Tracking & Compass =====================
let watchID,previousPos=null,userMarker=null;
const latP=document.getElementById('latitude'), lonP=document.getElementById('longitude'), altP=document.getElementById('altitude'),
speedP=document.getElementById('speed'), accP=document.getElementById('accuracy'), compassP=document.getElementById('compass'),
statusP=document.getElementById('status'), streetP=document.getElementById('street');

document.getElementById('getLocation').addEventListener('click',()=>{
  if(navigator.geolocation){
    watchID=navigator.geolocation.watchPosition(updatePosition,error,{enableHighAccuracy:true,maximumAge:0});
    statusP.textContent="Tracking started...";
  } else statusP.textContent="Geolocation not supported.";
});

function updatePosition(pos){
  const c=pos.coords;
  previousPos={lat:c.latitude,lon:c.longitude,alt:c.altitude,speed:c.speed,acc:c.accuracy};
  latP.textContent=`Latitude: ${c.latitude.toFixed(6)}`;
  lonP.textContent=`Longitude: ${c.longitude.toFixed(6)}`;
  altP.textContent=`Altitude: ${(c.altitude||0).toFixed(2)} m`;
  speedP.textContent=`Speed: ${(c.speed||0*3.6).toFixed(2)} km/h`;
  accP.textContent=`Accuracy: ${c.accuracy} m`;
  map.setView([c.latitude,c.longitude],15);
  if(!userMarker) userMarker=L.marker([c.latitude,c.longitude]).addTo(map).bindPopup("You are here").openPopup();
  else userMarker.setLatLng([c.latitude,c.longitude]);
  fetchStreetName(c.latitude,c.longitude);
}

function error(err){statusP.textContent=`ERROR(${err.code}): ${err.message}`;}

// ===================== Compass =====================
window.addEventListener('deviceorientationabsolute',e=>{
  let alpha=e.alpha||0;
  compassP.textContent=`Compass: ${alpha.toFixed(0)}¬∞ (${getDirectionName(alpha)})`;
});

function getDirectionName(angle){
  const dirs=["N","NE","E","SE","S","SW","W","NW"];
  return dirs[Math.floor((angle+22.5)/45)%8];
}

// ===================== Bookmarks =====================
let bookmarks=[];
const addBookmarkBtn=document.getElementById('addBookmark');
const clearMarkersBtn=document.getElementById('clearMarkers');
const bookmarkListDiv=document.getElementById('bookmarkList');

addBookmarkBtn.addEventListener('click',()=>{
  if(!previousPos) return alert("Start tracking first!");
  const name=prompt("Enter bookmark name:","My Location");
  bookmarks.push({name,lat:previousPos.lat,lon:previousPos.lon});
  renderBookmarks();
});

clearMarkersBtn.addEventListener('click',()=>{
  if(userMarker) map.removeLayer(userMarker);
  bookmarks=[];
  renderBookmarks();
});

function renderBookmarks(){
  bookmarkListDiv.innerHTML="";
  bookmarks.forEach(b=>{
    const div=document.createElement('div');
    div.textContent=`${b.name}: ${b.lat.toFixed(6)}, ${b.lon.toFixed(6)}`;
    bookmarkListDiv.appendChild(div);
  });
}

// ===================== SOS =====================
document.getElementById('sos').addEventListener('click',()=>{alert("SOS activated! Sending your location...");console.log(previousPos);});

// ===================== Battery Saver =====================
let batterySaver=false;
document.getElementById('batterySaverBtn').addEventListener('click',()=>{
  batterySaver=!batterySaver;
  document.getElementById('batterySaverBtn').textContent=`Battery Saver: ${batterySaver?"ON":"OFF"}`;
});

// ===================== Fetch Street Name =====================
async function fetchStreetName(lat,lon){
  try{
    const res=await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lat}&lon=${lon}&format=json`);
    const data=await res.json();
    streetP.textContent=`Street: ${data.address.road||data.display_name||"--"}`;
  }catch(e){streetP.textContent="Street: --";}
}
</script>
</body>
</html>

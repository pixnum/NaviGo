<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NaviGo - GPS Navigation</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><circle cx='32' cy='32' r='30' fill='black'/><circle cx='32' cy='32' r='12' fill='white'/></svg>">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',sans-serif;}
html,body{height:100%;width:100%;background:#f0f0f0;color:#222;transition:.3s;display:flex;justify-content:center;align-items:flex-start;}
body.dark{background:#121212;color:#f0f0f0;}
.container{width:100%; max-width:500px; margin:0 auto; padding:0; display:flex; flex-direction:column; align-items:center; position:relative;}
h1{font-size:1.5rem;margin:1rem 0;text-align:center;}
p{margin:0.3rem 0; font-size:0.9rem; word-wrap:break-word;}
button, select, input{padding:0.6rem 1rem;margin:0; border:none; border-radius:10px; font-size:0.95rem; cursor:pointer; transition:.3s;}
button:hover, select:hover, input:hover{opacity:.85;}
#toggleDark{position:absolute; top:1rem; right:1rem; width:45px; height:45px; border-radius:50%; border:2px solid #ccc; display:flex; justify-content:center; align-items:center; font-weight:bold; font-size:1.3rem; background:#fff; color:#222; cursor:pointer; z-index:999; transition:.3s;}
body.dark #toggleDark{background:#333; color:#fff; border-color:#666;}
#map{width:100%; height:100vh; border-radius:0; margin:0;}
.control-panel{position:fixed; bottom:0; left:0; width:100%; max-width:500px; background:#fff; border-top-left-radius:16px; border-top-right-radius:16px; box-shadow:0 -6px 25px rgba(0,0,0,.15); padding:1rem; transition:transform 0.3s ease; z-index:999;}
body.dark .control-panel{background:#1e1e1e; color:#f0f0f0;}
.control-panel.collapsed{transform:translateY(90%);}
#collapseBtn{position:absolute; top:-25px; left:50%; transform:translateX(-50%); border:none; background:#007bff; color:#fff; border-radius:50%; width:50px; height:25px; cursor:pointer; font-weight:bold;}
.row{display:flex; flex-direction:row; justify-content:space-between; gap:0.5rem; margin:0.3rem 0; flex-wrap:wrap;}
.row input, .row button, .row select{flex:1 1 100%; min-width:0;}
.bookmarks{margin-top:1rem;text-align:left;max-height:120px;overflow-y:auto;width:100%;}
.compass{margin-top:0.5rem;font-weight:bold;}
canvas{border:1px solid #ccc;border-radius:8px;margin-top:0.5rem;width:100% !important;height:auto !important;}
footer{margin-top:1rem;font-size:0.8rem;color:#888;text-align:center;}
body.dark footer{color:#aaa;}
@media(max-width:600px){#map{height:100vh;} h1{font-size:1.5rem;} }
@media(max-width:400px){
  .row{flex-wrap:wrap;}
  .row button, .row input, .row select{flex:1 1 100%;}
  p, .compass{font-size:0.85rem;}
  #toggleDark{width:50px;height:50px;font-size:1.4rem;}
}
@media(min-width:601px){ .control-panel{position:relative; transform:none; box-shadow:none;} #collapseBtn{display:none;} }
</style>
</head>
<body>
<div class="container">
<div id="toggleDark">ðŸŒ“</div>
<h1>NaviGo</h1>

<div class="control-panel" id="controlPanel">
<button id="collapseBtn">â–²</button>
<p id="status">Click "Start Tracking" to begin</p>
<p id="latitude"></p>
<p id="longitude"></p>
<p id="altitude"></p>
<p id="speed"></p>
<p id="distance"></p>
<p id="eta"></p>
<p class="compass" id="compass">Compass: --Â°</p>
<p id="accuracy">GPS Accuracy: -- m</p>

<div class="row">
<button id="getLocation">Start Tracking</button>
<button id="sos">Emergency SOS</button>
</div>

<div class="row">
<select id="mode">
<option value="driving-car">Driving</option>
<option value="cycling-regular">Cycling</option>
<option value="foot-walking">Walking</option>
</select>
<button id="addBookmark">Add Bookmark</button>
</div>

<div class="row">
<input type="text" id="searchPlace" placeholder="Type place name"/>
<button id="searchBtn">Search POI</button>
</div>

<div class="bookmarks" id="bookmarkList"></div>
<footer>Â© Manik Roy 2025 | All Rights Reserved</footer>
</div>

<div id="map"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
// Core JS functionality remains intact: GPS tracking, map, compass, speed, distance, ETA, bookmarks, SOS, POI search, dark mode
let map=L.map('map').setView([0,0],2);
let tileLayer=L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19, attribution:'&copy; OpenStreetMap contributors'}).addTo(map);
let marker, trail=L.polyline([], {color:'blue'}).addTo(map);
let watchId, previousPos=null, totalDistance=0, bookmarks=JSON.parse(localStorage.getItem('bookmarks')||"[]");

// Elements
const latElem=document.getElementById('latitude'), lonElem=document.getElementById('longitude'),
altElem=document.getElementById('altitude'), speedElem=document.getElementById('speed'),
distanceElem=document.getElementById('distance'), etaElem=document.getElementById('eta'),
compassElem=document.getElementById('compass'), accuracyElem=document.getElementById('accuracy'),
getLocationBtn=document.getElementById('getLocation'), toggleDarkBtn=document.getElementById('toggleDark'),
modeSelect=document.getElementById('mode'), addBookmarkBtn=document.getElementById('addBookmark'),
bookmarkList=document.getElementById('bookmarkList'), sosBtn=document.getElementById('sos'),
searchInput=document.getElementById('searchPlace'), searchBtn=document.getElementById('searchBtn'),
status=document.getElementById('status'), controlPanel=document.getElementById('controlPanel'),
collapseBtn=document.getElementById('collapseBtn');

// Dark mode
toggleDarkBtn.addEventListener('click',()=>{document.body.classList.toggle('dark'); map.getContainer().style.filter=document.body.classList.contains('dark')?'invert(90%) hue-rotate(180deg)':'';});

// Resize map
function resizeMap(){const panelHeight=controlPanel.classList.contains('collapsed')?0:controlPanel.offsetHeight;document.getElementById('map').style.height=(window.innerHeight-panelHeight)+'px'; map.invalidateSize();}
collapseBtn.addEventListener('click',()=>{controlPanel.classList.toggle('collapsed');collapseBtn.textContent=controlPanel.classList.contains('collapsed')?'â–¼':'â–²';resizeMap();});
window.addEventListener('resize',resizeMap); resizeMap();

// GPS tracking
function success(pos){
  const lat=pos.coords.latitude, lon=pos.coords.longitude;
  const alt=pos.coords.altitude||0, speed=pos.coords.speed||0, accuracy=pos.coords.accuracy;
  latElem.textContent=`Latitude: ${lat.toFixed(6)}`;
  lonElem.textContent=`Longitude: ${lon.toFixed(6)}`;
  altElem.textContent=`Altitude: ${alt.toFixed(2)} m`;
  speedElem.textContent=`Speed: ${(speed*3.6).toFixed(2)} km/h`;
  accuracyElem.textContent=`GPS Accuracy: ${accuracy} m`;
  if(previousPos) totalDistance+=calcDistance(previousPos.lat,previousPos.lon,lat,lon);
  previousPos={lat,lon};
  distanceElem.textContent=`Distance travelled: ${(totalDistance/1000).toFixed(3)} km`;
  etaElem.textContent=`ETA (5km remaining): ${calcETA(5000,speed)} min`;
  status.textContent='Tracking locationâ€¦';
  map.setView([lat,lon],15);
  if(marker) marker.setLatLng([lat,lon]); else marker=L.marker([lat,lon]).addTo(map).bindPopup("You are here").openPopup();
  updateTrail(lat,lon);
}
function error(){status.textContent='Unable to retrieve location';}
function startTracking(){if(watchId) navigator.geolocation.clearWatch(watchId); watchId=navigator.geolocation.watchPosition(success,error,{enableHighAccuracy:true,maximumAge:0,timeout:5000});}
getLocationBtn.addEventListener('click',startTracking);

// Distance & ETA
function calcDistance(lat1,lon1,lat2,lon2){const R=6371e3;const Ï†1=lat1*Math.PI/180;const Ï†2=lat2*Math.PI/180;const Î”Ï†=(lat2-lat1)*Math.PI/180;const Î”Î»=(lon2-lon1)*Math.PI/180;const a=Math.sin(Î”Ï†/2)**2+Math.cos(Ï†1)*Math.cos(Ï†2)*Math.sin(Î”Î»/2)**2;const c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));return R*c;}
function calcETA(distance,speed){return speed>0?(distance/speed/60).toFixed(2):'-';}

// Compass
if(window.DeviceOrientationEvent){window.addEventListener('deviceorientation',event=>{if(event.alpha!==null) compassElem.textContent=`Compass: ${event.alpha.toFixed(0)}Â°`;});}

// Bookmarks
function renderBookmarks(){bookmarkList.innerHTML=bookmarks.map((b,i)=>`<div>${b.name} <button onclick="goToBookmark(${i})">Go</button></div>`).join('');}
function goToBookmark(i){const b=bookmarks[i]; map.setView([b.lat,b.lon],15); if(marker) marker.setLatLng([b.lat,b.lon]); else marker=L.marker([b.lat,b.lon]).addTo(map).bindPopup(b.name).openPopup();}
renderBookmarks();
addBookmarkBtn.addEventListener('click',()=>{if(!previousPos){alert('No location to bookmark');return;} const name=prompt('Enter bookmark name','My Location'); if(!name) return; bookmarks.push({name,lat:previousPos.lat,lon:previousPos.lon}); localStorage.setItem('bookmarks',JSON.stringify(bookmarks)); renderBookmarks();});

// SOS
sosBtn.addEventListener('click',()=>{if(!previousPos){alert('No location available');return;} const link=`mailto:?subject=Emergency!&body=My location: https://www.google.com/maps?q=${previousPos.lat},${previousPos.lon}`; window.location.href=link;});

// POI search
searchBtn.addEventListener('click',()=>{ const query=searchInput.value.trim(); if(!query) return; if(!previousPos){ alert('Start tracking first'); return; } const url=`https://nominatim.openstreetmap.org/search?format=json&q=${query}&limit=5&viewbox=${previousPos.lon-0.05},${previousPos.lat+0.05},${previousPos.lon+0.05},${previousPos.lat-0.05}`; fetch(url).then(res=>res.json()).then(data=>{ data.forEach(p=>{ L.marker([p.lat,p.lon]).addTo(map).bindPopup(p.display_name); }); });});

// Breadcrumb trail
function updateTrail(lat,lon){trail.addLatLng([lat,lon]);}

// Map scale
L.control.scale().addTo(map);
</script>
</body>
</html>
